# Create a new session entry in the database corresponding to the current terminal session
hm_session_id=$(hm-db --db $hm_history_db -s "Not defined")

# Service string to split values of stored commands from other values
splitter="!!hmsplitter!!"

# Set a script to be executed after each other command in the current terminal session
export PROMPT_COMMAND='if [ $(id -u) -ne 0 ]; then echo ${hm_session_id}${splitter}"$(pwd)"${splitter}"$(history 1 | sed -E "s/^ *[0-9]* *//")"${splitter}$? >> $hm_history_tmp; fi'

# Alias for by-folder selection of commands from history and adding them at the beginning of the current terminal history
hm() {
SAVE_HISTFILE=$HISTFILE

HISTFILE=$(mktemp extracted_history.XXXXXXXXXX)

hm-db --db $hm_history_db -f $hm_history_tmp $@ > $HISTFILE && echo hm "$*" >> $HISTFILE && history -r
if [ $? -eq 0 ]; then echo "History successfully updated!"; fi

rm -rf $hm_history_tmp
#rm -rf $HISTFILE
echo $HISTFILE

HISTFILE=$SAVE_HISTFILE
}
